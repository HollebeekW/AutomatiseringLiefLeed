@model AutomatiseringLiefLeed.Models.Application
@{
    ViewBag.Title = "Details aanvraag";
}

<h2>Details aanvraag #@Model.Id</h2>

<table class="table">
    <tr><th>Id</th><td>@Model.Id</td></tr>
    @* <tr><th>Aanvrager Id</th><td>@Model.SenderId</td></tr> --Not needed*@
    <tr><th>Aanvrager Naam</th><td>@(Model.Sender.Roepnaam + " " + @Model.Sender.Achternaam)</td></tr>
    @* <tr><th>Ontvanger Id</th><td>@Model.RecipientId</td></tr> --Not needed*@
    <tr><th>Ontvanger Naam</th><td>@(Model.Recipient.Roepnaam + " " + @Model.Recipient.Achternaam)</td></tr>
    <tr><th>Datum aanvraag</th><td>@Model.DateOfApplication?.ToString("dd-MM-yyyy")</td></tr>
    <tr><th>Datum uitgifte</th><td>@Model.DateOfIssue?.ToString("dd-MM-yyyy")</td></tr>
    <tr><th>Geaccepteerd</th><td>@(Model.IsAccepted == true ? "Ja" : "Nee")</td></tr>
    <tr><th>Reden</th><td>@(Model.Reason != null ? Model.Reason.Name : Model.ReasonId.ToString())</td></tr>
</table>

<!-- Trigger modal for approve -->
<button type="button" class="btn btn-success d-inline" data-bs-toggle="modal" data-bs-target="#approveModal">
    Goedkeuren
</button>

<!-- Trigger modal for reject -->
<button type="button" class="btn btn-danger d-inline" data-bs-toggle="modal" data-bs-target="#rejectModal">
    Afkeuren en verwijderen
</button>

<!-- Approve Modal -->
<div class="modal fade" id="approveModal" tabindex="-1" aria-labelledby="approveModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="approveModalLabel">Weet je het zeker?</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Sluiten"></button>
      </div>
      <div class="modal-body">
        Weet je zeker dat je deze aanvraag wilt goedkeuren?
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Nee</button>
        <form asp-action="Approve" asp-route-id="@Model.Id" method="post" class="d-inline">
            <button type="submit" class="btn btn-success">Ja, goedkeuren</button>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Reject Modal -->
<div class="modal fade" id="rejectModal" tabindex="-1" aria-labelledby="rejectModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="rejectModalLabel">Weet je het zeker?</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Sluiten"></button>
      </div>
      <div class="modal-body">
        Weet je zeker dat je deze aanvraag wilt verwijderen?
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Nee</button>
        <form asp-action="Reject" asp-route-id="@Model.Id" method="post" class="d-inline">
            <button type="submit" class="btn btn-danger">Ja, verwijder</button>
        </form>
      </div>
    </div>
  </div>
</div>

<hr />
<h4>Voeg een opmerking toe</h4>
<form asp-action="AddNote" method="post">
    <input type="hidden" name="id" value="@Model.Id" />
    <div class="mb-3">
        <textarea name="note" class="form-control" rows="3" placeholder="Typ hier je opmerking..."></textarea>
    </div>
    <button type="submit" class="btn btn-primary">Opslaan</button>
</form>

<br />

@if (Model.Notes != null && Model.Notes.Any())
{
    <h4>Notities</h4>
    <ul class="list-group mb-3">
        @foreach (var note in Model.Notes)
        {
            <li class="list-group-item">
                <strong>@note.AuthorName</strong> (@note.CreatedAt.ToShortDateString()):<br />
                @note.Text
            </li>
        }
    </ul>
}
else
{
    <p>Er zijn nog geen notities toegevoegd.</p>
}

<a asp-action="Index" class="btn btn-secondary">Terug naar overzicht</a>

<!-- Bootstrap 5 modal requires JS bundle, ensure it's included in your layout or page -->
